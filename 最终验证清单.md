# 最终验证清单 - 图标与拖拽功能

## 🎯 快速验证步骤

### 步骤 1：重新加载插件 (2 分钟)

```bash
# 已构建完成
✅ .scaffold/build/zotero-weekly-plan.xpi
```

**操作**：

1. 打开 Zotero
2. 工具 → 附加组件
3. ⚙️ → 从文件安装附加组件
4. 选择 `zotero-weekly-plan.xpi`
5. 重启 Zotero

---

### 步骤 2：验证图标 (30 秒)

#### ✓ 检查工具栏图标

- [ ] 主工具栏显示 **精美的看板图标**（紫色渐变背景）
- [ ] 鼠标悬停显示"周计划"提示
- [ ] 图标清晰，无锯齿

#### ✓ 检查标签页图标

- [ ] 点击工具栏按钮
- [ ] 标签页标题旁显示同样的图标
- [ ] 图标大小合适

**预期效果**：

```
┌─────────────────────────────┐
│ Zotero 工具栏              │
│ [📚] [🔍] [⭐] [📋] ← 周计划 │
│                     ↑       │
│                  icon.svg   │
└─────────────────────────────┘
```

---

### 步骤 3：验证拖拽功能 (2 分钟)

#### ✓ 添加测试任务

1. 打开周计划面板
2. 在"规划"栏添加任务：
   - 任务 A
   - 任务 B
   - 任务 C

#### ✓ 测试拖拽手柄

- [ ] 任务左侧显示 **⋮** 图标
- [ ] 鼠标悬停时，⋮ 变亮并显示蓝色背景
- [ ] 光标变为 **grab**（抓手）

#### ✓ 测试拖拽操作

**测试 1：跨栏目拖拽**

- [ ] 拖动"任务 A"从"规划" → "待做"
  - ✅ 无红色禁止圆圈
  - ✅ 任务半透明 + 蓝色背景
  - ✅ 目标栏目显示蓝色虚线边框
  - ✅ 显示蓝色放置指示线
  - ✅ 释放后任务正确移动

**测试 2：同栏目排序**

- [ ] 在"待做"栏中拖动"任务 A"到其他位置
  - ✅ 放置指示线跟随鼠标
  - ✅ 任务顺序正确更新

**测试 3：所有栏目流转**

- [ ] 规划 → 待做 → 正在做 → 完成 ✅
- [ ] 完成 → 规划（反向） ✅

#### ✓ 测试编辑功能

- [ ] 点击任务内容，可正常编辑
- [ ] 双击任务内容，复制到剪贴板
- [ ] Enter 保存，Shift+Enter 换行
- [ ] **编辑时不触发拖拽** ← 重要！

---

### 步骤 4：验证数据持久化 (1 分钟)

1. 拖拽几个任务到不同栏目
2. 关闭周计划面板
3. 重新打开面板
4. [ ] 任务位置保持正确 ✅

---

## 🐛 问题诊断

### 如果拖拽仍然不工作

#### 检查点 1：查看控制台

```
Ctrl+Shift+J 打开控制台
应该看到：
✅ 开始拖拽任务: task_xxx
✅ 执行放置操作
✅ 放置到列表: zoteroplan-todoList
✅ 放置成功
✅ 拖拽结束
```

#### 检查点 2：验证 DOM 元素

```javascript
// 在控制台运行
const task = document.querySelector(".zoteroplan-task");
console.log("draggable:", task.getAttribute("draggable")); // 应该是 "true"
console.log("drag handle:", task.querySelector(".zoteroplan-task-drag-handle")); // 应该有值
```

#### 检查点 3：验证类名

```javascript
// 拖拽时在控制台检查
const dragging = document.querySelector(".dragging");
console.log("classes:", dragging?.className);
// 应该同时包含 'dragging' 和 'zoteroplan-task-dragging'
```

---

## ✅ 核心验证项

| 项目           | 预期结果                       | 状态 |
| -------------- | ------------------------------ | ---- |
| **图标**       | icon.svg 显示在工具栏          | ⬜   |
| **拖拽手柄**   | ⋮ 图标可见且可交互             | ⬜   |
| **跨栏目拖拽** | 规划 ↔ 待做 ↔ 正在做 ↔ 完成 | ⬜   |
| **无红色圆圈** | 拖动时显示移动光标             | ⬜   |
| **编辑不冲突** | 编辑时不触发拖拽               | ⬜   |
| **数据持久化** | 重启后位置保持                 | ⬜   |

---

## 🔧 关键修复点

### 修复 1：类名同步

```typescript
// ✅ 修复前
draggedEl.classList.add("dragging");

// ✅ 修复后
draggedEl.classList.add("dragging", "zoteroplan-task-dragging");
```

### 修复 2：图标路径

```typescript
// ✅ 修复前
const icon = `chrome://.../weekplan.svg`;

// ✅ 修复后
const icon = `chrome://.../icon.svg`;
```

---

## 📝 修改文件汇总

| 文件                                                                                            | 修改内容       |
| ----------------------------------------------------------------------------------------------- | -------------- |
| [`src/hooks.ts`](file://d:\Git%20Project\Zotero-Weekly-Plan\src\hooks.ts)                       | 图标路径：2 处 |
| [`src/modules/weekPlan.ts`](file://d:\Git%20Project\Zotero-Weekly-Plan\src\modules\weekPlan.ts) | 类名同步：2 处 |

**总修改行数**：+4, -4

---

## 🎉 验证成功标准

✅ **图标**：工具栏和标签页都显示精美的 icon.svg  
✅ **拖拽**：可以在四个栏目间自由拖拽任务  
✅ **无障碍**：没有红色禁止圆圈  
✅ **稳定**：数据保存正确，重启后保持

---

## 📞 如需帮助

如果验证中发现问题，请记录：

1. **控制台日志**：Ctrl+Shift+J 查看
2. **错误截图**：拖拽时的界面状态
3. **操作步骤**：如何重现问题

提供这些信息可以快速定位和解决问题。

---

**预计验证时间：5 分钟**  
**预期结果：所有测试项通过 ✅**
