# 快速测试拖拽功能指南

## 🚀 快速开始

### 1. 重新加载插件

在 Zotero 中：

1. 打开"工具 → 附加组件"
2. 点击齿轮图标 ⚙️
3. 选择"从文件安装附加组件"
4. 找到并选择：`.scaffold/build/zotero-weekly-plan.xpi`
5. 重启 Zotero

### 2. 打开周计划面板

- 点击 Zotero 工具栏的"周计划"按钮
- 或使用快捷键（如果已配置）

---

## ✅ 测试清单

### 基础拖拽测试

#### ✓ 测试 1：拖拽手柄可见性

- [ ] 任务卡片左侧显示 **⋮** 图标
- [ ] 鼠标悬停时，图标变亮并显示蓝色背景
- [ ] 鼠标悬停时，光标变为 **grab**（抓手）

#### ✓ 测试 2：基本拖拽功能

- [ ] 点击并按住 **⋮** 图标
- [ ] 拖动时光标变为 **grabbing**
- [ ] 拖动时任务卡片半透明并略微旋转
- [ ] **不出现红色禁止圆圈** ← 关键测试点！

#### ✓ 测试 3：放置指示器

- [ ] 拖动任务时，目标栏目显示蓝色虚线边框
- [ ] 在任务间移动时，显示蓝色指示线
- [ ] 指示线位置跟随鼠标移动

#### ✓ 测试 4：跨栏目拖拽

- [ ] 从"规划"拖到"待做" ✅
- [ ] 从"待做"拖到"正在做" ✅
- [ ] 从"正在做"拖到"完成" ✅
- [ ] 从"完成"拖回"规划" ✅

#### ✓ 测试 5：同栏目内排序

- [ ] 在同一栏目内，拖动任务到不同位置
- [ ] 任务顺序正确更新
- [ ] 放置到列表顶部 ✅
- [ ] 放置到列表中间 ✅
- [ ] 放置到列表底部 ✅

---

### 编辑功能测试

#### ✓ 测试 6：内容编辑不触发拖拽

- [ ] 点击任务内容区域
- [ ] 光标变为文本编辑光标（|）
- [ ] 可以正常输入文字
- [ ] **不会意外触发拖拽**

#### ✓ 测试 7：双击复制功能

- [ ] 双击任务内容
- [ ] 内容被选中
- [ ] 内容已复制到剪贴板（粘贴测试）

#### ✓ 测试 8：快捷键功能

- [ ] 编辑时按 **Enter** 保存并退出编辑
- [ ] 编辑时按 **Shift+Enter** 换行
- [ ] 编辑时按 **Esc** 取消编辑

---

### 数据持久化测试

#### ✓ 测试 9：自动保存

- [ ] 拖拽任务后释放鼠标
- [ ] 关闭周计划面板
- [ ] 重新打开面板
- [ ] 任务位置保持正确

#### ✓ 测试 10：空列表处理

- [ ] 将一个栏目的所有任务拖到其他栏目
- [ ] 空栏目显示"还没有任务，点击下方添加吧！"
- [ ] 拖拽任务到空栏目
- [ ] 空状态提示消失

---

## 🐛 故障排查

### 问题 1：拖拽手柄不可见

**检查**：

1. 打开浏览器控制台（Ctrl+Shift+J）
2. 查看是否有 CSS 加载错误
3. 确认 `weekPlan.css` 已更新

### 问题 2：仍然出现红色禁止圆圈

**检查**：

1. 确认任务元素有 `draggable="true"` 属性
2. 打开控制台查看是否有 JavaScript 错误
3. 检查 `dragstart` 事件中是否错误调用了 `preventDefault()`

### 问题 3：拖拽后任务消失

**检查**：

1. 打开控制台查看日志
2. 应该看到：
   ```
   开始拖拽任务: task_xxx
   执行放置操作
   放置到列表: zoteroplan-todoList
   放置成功
   拖拽结束
   ```
3. 如果缺少某些日志，说明对应事件未触发

### 问题 4：编辑时意外触发拖拽

**检查**：

1. 确认内容区域有 `draggable="false"` 属性
2. 确认 content 的 dragstart 事件被阻止

---

## 📊 预期结果

### 正常的拖拽流程

```
1. 用户鼠标悬停在 ⋮ 图标上
   ↓ 光标：grab

2. 用户按住鼠标左键
   ↓ 光标：grabbing
   ↓ 任务：半透明 + 旋转

3. 用户拖动到目标栏目
   ↓ 目标栏目：蓝色虚线边框
   ↓ 显示：蓝色放置指示线

4. 用户释放鼠标
   ↓ 任务：移动到新位置
   ↓ 自动保存
   ↓ 界面更新
```

### 控制台日志输出

```javascript
开始拖拽任务: task_1234567890_abc;
执行放置操作;
放置到列表: zoteroplan - doingList;
放置成功;
拖拽结束;
```

---

## 🎯 关键测试点

### 🔴 必须通过的测试（核心功能）

1. ✅ **无红色禁止圆圈** - 这是用户反馈的主要问题
2. ✅ **跨栏目拖拽** - 规划、待做、正在做、完成之间可以自由移动
3. ✅ **编辑不触发拖拽** - 编辑和拖拽功能互不干扰
4. ✅ **数据持久化** - 拖拽后的位置能保存

### 🟡 重要测试（用户体验）

5. ✅ **拖拽手柄可见** - 用户能清楚知道从哪里拖拽
6. ✅ **视觉反馈** - 放置指示器、悬停效果等
7. ✅ **双击复制** - 便捷的内容复制功能

---

## 📞 反馈

如果测试中发现任何问题，请记录：

1. **问题描述**：具体是什么不工作
2. **重现步骤**：如何触发问题
3. **控制台日志**：复制相关的错误或日志
4. **浏览器信息**：Zotero 版本号

---

## 🎉 完成

如果所有测试都通过，恭喜！拖拽功能已经完全修复！

如果还有问题，请提供详细的错误信息，我会继续优化。
