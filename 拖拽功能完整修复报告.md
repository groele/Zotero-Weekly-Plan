# æ‹–æ‹½åŠŸèƒ½å®Œæ•´ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜è¯Šæ–­

### ç”¨æˆ·åé¦ˆçš„é—®é¢˜

1. **çº¢è‰²ç¦æ­¢åœ†åœˆ**ï¼šæ‹–åŠ¨æ¡ç›®æ—¶å‡ºç°çº¢è‰²ç¦æ­¢åœ†åœˆ
2. **æ‹–æ‹½ä¸å·¥ä½œ**ï¼šæ¡ç›®åœ¨"è§„åˆ’ã€å¾…åšã€æ­£åœ¨åšã€å®Œæˆ"ä¹‹é—´æ— æ³•æ‹–æ‹½
3. **é€»è¾‘é”™è¯¯**ï¼šæ‹–æ‹½åŠŸèƒ½å­˜åœ¨å¤šå¤„ä¸¥é‡çš„é€»è¾‘é—®é¢˜

### æ ¹æœ¬åŸå› åˆ†æ

#### 1. **äº‹ä»¶ç›‘å¬å™¨é‡å¤ç»‘å®š**ï¼ˆæœ€ä¸¥é‡ï¼‰

```typescript
// âŒ é”™è¯¯ï¼šåœ¨ renderTask() ä¸­ä¸ºæ¯ä¸ªä»»åŠ¡å•ç‹¬æ·»åŠ æ‹–æ‹½äº‹ä»¶
taskElement.addEventListener("dragstart", (e) => {
  // ...
  e.preventDefault(); // è¿™ä¼šé˜»æ­¢æ‹–æ‹½å¼€å§‹ï¼
});

// âŒ é”™è¯¯ï¼šåœ¨ addEventListeners() ä¸­åˆç”¨äº‹ä»¶å§”æ‰˜æ·»åŠ äº†ä¸€é
board.addEventListener("dragstart", (e: Event) => {
  // ...
});
```

**åæœ**ï¼š

- ä¸¤å¥—äº‹ä»¶ç›‘å¬å™¨äº’ç›¸å¹²æ‰°
- `preventDefault()` åœ¨ dragstart ä¸­ä¼šå®Œå…¨é˜»æ­¢æ‹–æ‹½
- äº‹ä»¶å†’æ³¡å’Œæ•è·é˜¶æ®µæ··ä¹±

#### 2. **ç¼ºå°‘ draggable å±æ€§**

```typescript
// âŒ é”™è¯¯ï¼šä»»åŠ¡å…ƒç´ æ²¡æœ‰è®¾ç½® draggable="true"
const taskElement = this.panelDoc.createElement("div");
taskElement.className = "zoteroplan-task";
// ç¼ºå°‘ draggable å±æ€§
```

**åæœ**ï¼š

- æµè§ˆå™¨ä¸çŸ¥é“è¯¥å…ƒç´ å¯ä»¥æ‹–æ‹½
- æ˜¾ç¤ºçº¢è‰²ç¦æ­¢åœ†åœˆ

#### 3. **contentEditable ä¸æ‹–æ‹½å†²çª**

```typescript
// âŒ é”™è¯¯ï¼šcontentEditable å…ƒç´ å¯èƒ½é»˜è®¤ draggable=true
content.contentEditable = "true";
// æ²¡æœ‰æ˜¾å¼ç¦æ­¢æ‹–æ‹½
```

**åæœ**ï¼š

- å†…å®¹åŒºåŸŸä¸ä»»åŠ¡å…ƒç´ çš„æ‹–æ‹½äº‹ä»¶å†²çª
- æ‹–æ‹½è¡Œä¸ºä¸å¯é¢„æµ‹

#### 4. **ç¼ºå°‘æ‹–æ‹½æ‰‹æŸ„**

- æ²¡æœ‰æ˜ç¡®çš„æ‹–æ‹½è§¦å‘åŒºåŸŸ
- ç”¨æˆ·ä½“éªŒå·®ï¼Œå®¹æ˜“è¯¯è§¦

---

## ğŸ”§ å®Œæ•´ä¿®å¤æ–¹æ¡ˆ

### ä¿®å¤ 1ï¼šé‡å†™ renderTask() - ç§»é™¤æ‰€æœ‰æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨

**æ–‡ä»¶**ï¼š`src/modules/weekPlan.ts`

```typescript
/**
 * æ¸²æŸ“å•ä¸ªä»»åŠ¡
 */
private renderTask(taskData: Task): HTMLElement | null {
  if (!this.panelDoc || !taskData || typeof taskData !== "object") return null;

  const taskElement = this.panelDoc.createElement("div");
  taskElement.className = "zoteroplan-task";
  taskElement.dataset.id = taskData.id || `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
  taskElement.dataset.created = taskData.created || new Date().toISOString();
  taskElement.dataset.priority = taskData.priority || "none";
  // âœ… å…³é”®ï¼šè®¾ç½®ä»»åŠ¡å…ƒç´ å¯æ‹–æ‹½
  taskElement.setAttribute("draggable", "true");

  // ... å…¶ä»–å±æ€§è®¾ç½® ...

  // âœ… æ·»åŠ æ‹–æ‹½æ‰‹æŸ„
  const dragHandle = this.panelDoc.createElement("div");
  dragHandle.className = "zoteroplan-task-drag-handle";
  dragHandle.innerHTML = "â‹®";
  dragHandle.title = "æ‹–æ‹½ç§»åŠ¨ä»»åŠ¡";
  taskElement.appendChild(dragHandle);

  // âœ… ä»»åŠ¡å†…å®¹
  const content = this.panelDoc.createElement("div");
  content.className = "zoteroplan-task-content";
  content.textContent = taskData.text || "";
  content.contentEditable = "true";
  content.setAttribute("spellcheck", "false");
  content.setAttribute("draggable", "false"); // âœ… ç¦æ­¢å†…å®¹åŒºåŸŸæ‹–æ‹½
  content.addEventListener("blur", () => this.saveForWeek());

  // âœ… é˜»æ­¢å†…å®¹åŒºåŸŸçš„æ‹–æ‹½äº‹ä»¶å†’æ³¡
  content.addEventListener(
    "dragstart",
    (e: Event) => {
      e.stopPropagation();
      e.preventDefault();
    },
    true, // ä½¿ç”¨æ•è·é˜¶æ®µ
  );

  // âœ… åŒå‡»å¤åˆ¶ä»»åŠ¡å†…å®¹
  content.addEventListener("dblclick", (e: Event) => {
    e.preventDefault();
    e.stopPropagation();
    const text = content.textContent?.trim() || "";
    if (!text) return;
    try {
      const clipboardHelper = (Components.classes as any)[
        "@mozilla.org/widget/clipboardhelper;1"
      ].getService((Components.interfaces as any).nsIClipboardHelper);
      clipboardHelper.copyString(text);
      // é€‰ä¸­å…¨éƒ¨æ–‡æœ¬
      const selection = this.panelDoc!.defaultView?.getSelection();
      const range = this.panelDoc!.createRange();
      range.selectNodeContents(content);
      selection?.removeAllRanges();
      selection?.addRange(range);
      ztoolkit.log("ä»»åŠ¡å†…å®¹å·²å¤åˆ¶:", text);
    } catch (err) {
      ztoolkit.log("å¤åˆ¶å¤±è´¥:", err);
    }
  });

  // âœ… Enteré”®ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘ï¼ŒShift+Enteræ¢è¡Œ
  content.addEventListener("keydown", (e: KeyboardEvent) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      content.blur();
    }
    if (e.key === "Escape") {
      e.preventDefault();
      content.textContent = taskData.text || "";
      content.blur();
    }
  });

  content.title = "åŒå‡»å¤åˆ¶ | Enterä¿å­˜ | Shift+Enteræ¢è¡Œ | Escå–æ¶ˆ";

  // ... æ ‡ç­¾ã€å¤‡æ³¨ã€å…ƒæ•°æ®ç­‰ ...

  // âŒ åˆ é™¤ï¼šä¸å†åœ¨è¿™é‡Œæ·»åŠ æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
  // æ‰€æœ‰æ‹–æ‹½äº‹ä»¶é€šè¿‡ addEventListeners() ä¸­çš„äº‹ä»¶å§”æ‰˜ç»Ÿä¸€å¤„ç†

  return taskElement;
}
```

**å…³é”®æ”¹è¿›**ï¼š

1. âœ… è®¾ç½® `draggable="true"`
2. âœ… æ·»åŠ æ‹–æ‹½æ‰‹æŸ„
3. âœ… å†…å®¹åŒºåŸŸè®¾ç½® `draggable="false"`
4. âœ… é˜»æ­¢å†…å®¹åŒºåŸŸçš„ dragstart äº‹ä»¶
5. âœ… ç§»é™¤äº†æ‰€æœ‰å•ç‹¬çš„æ‹–æ‹½äº‹ä»¶ç›‘å¬å™¨
6. âœ… ä¿ç•™åŒå‡»å¤åˆ¶åŠŸèƒ½

---

### ä¿®å¤ 2ï¼šå®Œå…¨é‡å†™ addEventListeners() - ä½¿ç”¨äº‹ä»¶å§”æ‰˜

**æ–‡ä»¶**ï¼š`src/modules/weekPlan.ts`

```typescript
/**
 * æ·»åŠ æ‹–æ‹½ç›¸å…³äº‹ä»¶ç›‘å¬å™¨ - ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¨¡å¼
 */
private addEventListeners(): void {
  if (!this.panelDoc) return;

  const board = this.panelDoc.getElementById("zoteroplan-board");
  if (!board) {
    ztoolkit.log("æ‰¾ä¸åˆ°çœ‹æ¿å…ƒç´ ");
    return;
  }

  // âœ… æ‹–æ‹½çŠ¶æ€ç®¡ç†
  let draggedEl: HTMLElement | null = null;
  const dropIndicator = this.panelDoc.createElement("div");
  dropIndicator.className = "zoteroplan-drop-indicator";

  // âœ… äº‹ä»¶ï¼šdragstart - ä½¿ç”¨æ•è·é˜¶æ®µ
  board.addEventListener(
    "dragstart",
    (e: Event) => {
      const dragEvent = e as DragEvent;
      const target = dragEvent.target as HTMLElement;

      // ç¡®è®¤æ˜¯ä»»åŠ¡å…ƒç´ 
      if (!target || !target.classList.contains("zoteroplan-task")) {
        ztoolkit.log("æ‹–æ‹½çš„ä¸æ˜¯ä»»åŠ¡å…ƒç´ ", target);
        return; // âœ… ä¸è°ƒç”¨ preventDefault()ï¼Œè®©å…¶ä»–å…ƒç´ æ­£å¸¸æ‹–æ‹½
      }

      draggedEl = target;
      draggedEl.classList.add("dragging");

      // âœ… è®¾ç½®æ‹–æ‹½æ•°æ®
      if (dragEvent.dataTransfer) {
        dragEvent.dataTransfer.effectAllowed = "move";
        dragEvent.dataTransfer.setData(
          "text/plain",
          draggedEl.dataset.id || "",
        );
        try {
          dragEvent.dataTransfer.setDragImage(draggedEl, 20, 20);
        } catch (err) {
          // å¿½ç•¥é”™è¯¯
        }
      }

      ztoolkit.log("å¼€å§‹æ‹–æ‹½ä»»åŠ¡:", draggedEl.dataset.id);
    },
    true, // âœ… æ•è·é˜¶æ®µ
  );

  // âœ… äº‹ä»¶ï¼šdragend - æ¸…ç†æ‹–æ‹½çŠ¶æ€
  board.addEventListener(
    "dragend",
    (e: Event) => {
      ztoolkit.log("æ‹–æ‹½ç»“æŸ");

      if (draggedEl) {
        draggedEl.classList.remove("dragging");
        draggedEl = null;
      }
      dropIndicator.remove();

      // æ¸…ç†æ‰€æœ‰åˆ—çš„ drag-over çŠ¶æ€
      this.columns.forEach((col) => {
        const listEl = this.panelDoc!.getElementById(`zoteroplan-${col}List`);
        if (listEl) {
          listEl.classList.remove("drag-over");
        }
      });

      // ä¿å­˜æ•°æ®å¹¶æ›´æ–°UI
      this.saveForWeek();
      this.applySearchFilter();
    },
    true, // âœ… æ•è·é˜¶æ®µ
  );

  // âœ… äº‹ä»¶ï¼šdragover - æ˜¾ç¤ºæ”¾ç½®æŒ‡ç¤ºå™¨
  board.addEventListener(
    "dragover",
    (e: DragEvent) => {
      // âœ… å…³é”®ï¼šå§‹ç»ˆ preventDefault
      e.preventDefault();
      e.stopPropagation();

      if (e.dataTransfer) {
        e.dataTransfer.dropEffect = "move"; // âœ… æ˜¾ç¤ºç§»åŠ¨å…‰æ ‡
      }

      if (!draggedEl) {
        return;
      }

      // âœ… æ‰¾åˆ°ç›®æ ‡åˆ—è¡¨
      let targetList: HTMLElement | null = null;
      let target = e.target as Element;

      // å‘ä¸ŠæŸ¥æ‰¾ç›´åˆ°æ‰¾åˆ°åˆ—è¡¨å®¹å™¨
      while (target && target !== board) {
        if (
          target.classList &&
          target.classList.contains("zoteroplan-col-list")
        ) {
          targetList = target as HTMLElement;
          break;
        }
        target = target.parentElement as Element;
      }

      // æ¸…ç†æ‰€æœ‰åˆ—è¡¨çš„ drag-over çŠ¶æ€
      this.columns.forEach((col) => {
        const el = this.panelDoc!.getElementById(`zoteroplan-${col}List`);
        if (el) {
          el.classList.remove("drag-over");
        }
      });

      if (!targetList) {
        dropIndicator.remove();
        return;
      }

      targetList.classList.add("drag-over");

      // âœ… è®¡ç®—åº”è¯¥æ”¾ç½®çš„ä½ç½®
      const afterElement = this.getDragAfterElement(targetList, e.clientY);

      if (afterElement === null) {
        // æ”¾åœ¨åˆ—è¡¨æœ«å°¾
        targetList.appendChild(dropIndicator);
      } else if (afterElement === undefined) {
        // æ”¾åœ¨åˆ—è¡¨å¼€å¤´
        if (targetList.firstChild) {
          targetList.insertBefore(dropIndicator, targetList.firstChild);
        } else {
          targetList.appendChild(dropIndicator);
        }
      } else {
        // æ”¾åœ¨æŒ‡å®šå…ƒç´ ä¹‹å‰
        targetList.insertBefore(dropIndicator, afterElement);
      }
    },
    true, // âœ… æ•è·é˜¶æ®µ
  );

  // âœ… äº‹ä»¶ï¼šdrop - æ‰§è¡Œæ”¾ç½®æ“ä½œ
  board.addEventListener(
    "drop",
    (e: DragEvent) => {
      // âœ… å…³é”®ï¼šå¿…é¡» preventDefault
      e.preventDefault();
      e.stopPropagation();

      ztoolkit.log("æ‰§è¡Œæ”¾ç½®æ“ä½œ");

      if (!draggedEl) {
        ztoolkit.log("æ²¡æœ‰æ‹–æ‹½å…ƒç´ ");
        return;
      }

      // âœ… æ‰¾åˆ°ç›®æ ‡åˆ—è¡¨
      let targetList: HTMLElement | null = null;
      let target = e.target as Element;

      while (target && target !== board) {
        if (
          target.classList &&
          target.classList.contains("zoteroplan-col-list")
        ) {
          targetList = target as HTMLElement;
          break;
        }
        target = target.parentElement as Element;
      }

      if (!targetList) {
        ztoolkit.log("æ‰¾ä¸åˆ°ç›®æ ‡åˆ—è¡¨");
        return;
      }

      ztoolkit.log("æ”¾ç½®åˆ°åˆ—è¡¨:", targetList.id);

      // ç§»é™¤ç©ºçŠ¶æ€æç¤º
      const emptyState = targetList.querySelector(".zoteroplan-empty-state");
      if (emptyState) {
        emptyState.remove();
      }

      // âœ… æ‰§è¡Œæ”¾ç½®
      if (dropIndicator.parentNode === targetList) {
        targetList.insertBefore(draggedEl, dropIndicator);
      } else {
        targetList.appendChild(draggedEl);
      }

      ztoolkit.log("æ”¾ç½®æˆåŠŸ");

      // âœ… æ£€æŸ¥æºåˆ—è¡¨æ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™æ˜¾ç¤ºç©ºçŠ¶æ€
      this.columns.forEach((col) => {
        const listEl = this.panelDoc!.getElementById(`zoteroplan-${col}List`);
        if (listEl) {
          const tasks = listEl.querySelectorAll(".zoteroplan-task");
          if (
            tasks.length === 0 &&
            !listEl.querySelector(".zoteroplan-empty-state")
          ) {
            this.showEmptyState(listEl as HTMLElement);
          }
        }
      });
    },
    true, // âœ… æ•è·é˜¶æ®µ
  );
}
```

**å…³é”®æ”¹è¿›**ï¼š

1. âœ… ç»Ÿä¸€ä½¿ç”¨äº‹ä»¶å§”æ‰˜æ¨¡å¼
2. âœ… æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨ä½¿ç”¨æ•è·é˜¶æ®µï¼ˆ`true`ï¼‰
3. âœ… dragstart ä¸­ä¸è°ƒç”¨ `preventDefault()`
4. âœ… dragover ä¸­å§‹ç»ˆ `preventDefault()` å¹¶è®¾ç½® `dropEffect = "move"`
5. âœ… æ­£ç¡®çš„çŠ¶æ€ç®¡ç†å’Œæ¸…ç†
6. âœ… å®Œæ•´çš„æ—¥å¿—è®°å½•ä¾¿äºè°ƒè¯•

---

### ä¿®å¤ 3ï¼šæ·»åŠ æ‹–æ‹½æ‰‹æŸ„æ ·å¼

**æ–‡ä»¶**ï¼š`addon/content/weekPlan.css`

```css
/* ç¡®ä¿ä»»åŠ¡å…ƒç´ å¯æ‹–æ‹½ */
.zoteroplan-task {
  -webkit-user-drag: element;
  user-select: none;
  cursor: default; /* âœ… æ”¹ä¸º defaultï¼Œåªæœ‰æ‹–æ‹½æ‰‹æŸ„æ˜¾ç¤º grab */
  padding-left: 38px; /* âœ… ç•™å‡ºæ‹–æ‹½æ‰‹æŸ„ç©ºé—´ */
}

/* âœ… æ‹–æ‹½æ‰‹æŸ„æ ·å¼ */
.zoteroplan-task-drag-handle {
  position: absolute;
  left: 0;
  top: 0;
  width: 30px;
  height: 100%;
  z-index: 10; /* âœ… ç¡®ä¿åœ¨å†…å®¹ä¹‹ä¸Š */
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.3;
  font-size: 16px;
  color: var(--wp-text-muted);
  transition: all 0.2s ease;
  user-select: none;
}

.zoteroplan-task:hover .zoteroplan-task-drag-handle {
  opacity: 1;
  color: var(--wp-accent);
  background: rgba(0, 123, 255, 0.05);
}

.zoteroplan-task-drag-handle:active {
  cursor: grabbing;
}

/* âœ… ä»»åŠ¡å†…å®¹åŒºåŸŸ */
.zoteroplan-task-content {
  z-index: 1; /* âœ… ä½äºæ‹–æ‹½æ‰‹æŸ„ */
  cursor: text;
  user-select: text;
}

/* âœ… æ‹–æ‹½ä¸­çš„ä»»åŠ¡æ ·å¼ */
.zoteroplan-task.dragging {
  opacity: 0.5;
  cursor: grabbing;
  transform: rotate(2deg);
}
```

**å…³é”®æ”¹è¿›**ï¼š

1. âœ… æ‹–æ‹½æ‰‹æŸ„ç‹¬ç«‹æ ·å¼ï¼Œz-index ä¸º 10
2. âœ… å†…å®¹åŒºåŸŸ z-index ä¸º 1ï¼Œç¡®ä¿æ‰‹æŸ„åœ¨ä¸Šå±‚
3. âœ… ä»»åŠ¡å¡ç‰‡ padding-left: 38px ç•™å‡ºæ‰‹æŸ„ç©ºé—´
4. âœ… æ‚¬åœæ•ˆæœæå‡å¯è§æ€§
5. âœ… æ‹–æ‹½ä¸­çš„è§†è§‰åé¦ˆ

---

## âœ… ä¿®å¤æ•ˆæœ

### åŠŸèƒ½æµ‹è¯•æ¸…å•

| æµ‹è¯•é¡¹           | é¢„æœŸç»“æœ                    | çŠ¶æ€ |
| ---------------- | --------------------------- | ---- |
| ä»»åŠ¡å…ƒç´ å¯æ‹–æ‹½   | âœ… è®¾ç½® `draggable="true"`  | é€šè¿‡ |
| æ‹–æ‹½æ‰‹æŸ„å¯è§     | âœ… å·¦ä¾§æ˜¾ç¤º â‹® å›¾æ ‡          | é€šè¿‡ |
| æ‹–æ‹½æ‰‹æŸ„å¯ç‚¹å‡»   | âœ… é¼ æ ‡æ‚¬åœæ˜¾ç¤º grab å…‰æ ‡   | é€šè¿‡ |
| æ‹–æ‹½æ—¶æ— çº¢è‰²åœ†åœˆ | âœ… æ˜¾ç¤ºç§»åŠ¨å…‰æ ‡             | é€šè¿‡ |
| è·¨æ ç›®æ‹–æ‹½       | âœ… å¯åœ¨å››ä¸ªæ ç›®é—´è‡ªç”±æ‹–æ‹½   | é€šè¿‡ |
| æ”¾ç½®æŒ‡ç¤ºå™¨       | âœ… æ˜¾ç¤ºè“è‰²è™šçº¿æŒ‡ç¤ºæ”¾ç½®ä½ç½® | é€šè¿‡ |
| å†…å®¹å¯ç¼–è¾‘       | âœ… ç‚¹å‡»å†…å®¹å¯ç¼–è¾‘           | é€šè¿‡ |
| åŒå‡»å¤åˆ¶         | âœ… åŒå‡»å¤åˆ¶ä»»åŠ¡å†…å®¹         | é€šè¿‡ |
| Enter ä¿å­˜       | âœ… Enter é”®ä¿å­˜å¹¶é€€å‡ºç¼–è¾‘   | é€šè¿‡ |
| Shift+Enter æ¢è¡Œ | âœ… æ¢è¡ŒåŠŸèƒ½æ­£å¸¸             | é€šè¿‡ |
| æ‹–æ‹½åè‡ªåŠ¨ä¿å­˜   | âœ… æ•°æ®æŒä¹…åŒ–               | é€šè¿‡ |

---

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹

### 1. äº‹ä»¶å§”æ‰˜æ¨¡å¼

- **ä¼˜åŠ¿**ï¼šç»Ÿä¸€ç®¡ç†ï¼Œé¿å…å†…å­˜æ³„æ¼
- **å®ç°**ï¼šåœ¨ board ä¸Šç›‘å¬ï¼Œé€šè¿‡ `target.classList.contains()` åˆ¤æ–­

### 2. äº‹ä»¶æ•è·é˜¶æ®µ

- **åŸå› **ï¼šFirefox/Zotero ç¯å¢ƒä¸­ï¼Œæ•è·é˜¶æ®µä¼˜å…ˆçº§æ›´é«˜
- **å®ç°**ï¼š`addEventListener(event, handler, true)`

### 3. æ­£ç¡®çš„ preventDefault ä½¿ç”¨

- **dragstart**ï¼šä¸è°ƒç”¨ï¼ˆä¼šé˜»æ­¢æ‹–æ‹½ï¼‰
- **dragover**ï¼šå¿…é¡»è°ƒç”¨ï¼ˆå…è®¸ dropï¼‰
- **drop**ï¼šå¿…é¡»è°ƒç”¨ï¼ˆé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼‰

### 4. contentEditable å†²çªå¤„ç†

- è®¾ç½® `draggable="false"`
- é˜»æ­¢ dragstart äº‹ä»¶å†’æ³¡

### 5. æ‹–æ‹½æ‰‹æŸ„è®¾è®¡

- æ˜ç¡®çš„äº¤äº’åŒºåŸŸ
- z-index å±‚çº§ç®¡ç†
- è§†è§‰åé¦ˆ

---

## ğŸ“ ç”¨æˆ·æ“ä½œæŒ‡å—

### æ‹–æ‹½ä»»åŠ¡

1. é¼ æ ‡æ‚¬åœåœ¨ä»»åŠ¡å·¦ä¾§çš„ **â‹®** å›¾æ ‡ä¸Š
2. æŒ‰ä½é¼ æ ‡å·¦é”®æ‹–åŠ¨
3. çœ‹åˆ°è“è‰²è™šçº¿æŒ‡ç¤ºæ”¾ç½®ä½ç½®
4. é‡Šæ”¾é¼ æ ‡å®Œæˆæ‹–æ‹½

### ç¼–è¾‘ä»»åŠ¡

1. ç‚¹å‡»ä»»åŠ¡å†…å®¹åŒºåŸŸ
2. ç›´æ¥è¾“å…¥ç¼–è¾‘
3. Enter ä¿å­˜ï¼ŒShift+Enter æ¢è¡Œï¼ŒEsc å–æ¶ˆ

### å¤åˆ¶ä»»åŠ¡

1. åŒå‡»ä»»åŠ¡å†…å®¹
2. å†…å®¹è‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
3. æ–‡æœ¬è¢«é€‰ä¸­

---

## ğŸ” è°ƒè¯•ä¿¡æ¯

æ‰€æœ‰æ‹–æ‹½æ“ä½œéƒ½ä¼šè¾“å‡ºæ—¥å¿—åˆ° Zotero æ§åˆ¶å°ï¼š

```javascript
ztoolkit.log("å¼€å§‹æ‹–æ‹½ä»»åŠ¡:", draggedEl.dataset.id);
ztoolkit.log("æ‹–æ‹½ç»“æŸ");
ztoolkit.log("æ‰§è¡Œæ”¾ç½®æ“ä½œ");
ztoolkit.log("æ”¾ç½®åˆ°åˆ—è¡¨:", targetList.id);
ztoolkit.log("æ”¾ç½®æˆåŠŸ");
```

åœ¨ Zotero ä¸­æ‰“å¼€æ§åˆ¶å°ï¼š

- èœå•ï¼šå¸®åŠ© â†’ å¼€å‘è€… â†’ Error Console
- å¿«æ·é”®ï¼šCtrl+Shift+Jï¼ˆWindowsï¼‰

---

## ğŸ“¦ æ„å»ºå’Œéƒ¨ç½²

```bash
# æ„å»ºæ’ä»¶
npm run build

# æ ¼å¼åŒ–ä»£ç 
npm run lint:fix

# è¾“å‡ºæ–‡ä»¶
.scaffold/build/zotero-weekly-plan.xpi
```

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¿®å¤å½»åº•è§£å†³äº†æ‹–æ‹½åŠŸèƒ½çš„æ‰€æœ‰é—®é¢˜ï¼š

1. âœ… **ç§»é™¤äº‹ä»¶ç›‘å¬å™¨é‡å¤ç»‘å®š**
2. âœ… **æ­£ç¡®è®¾ç½® draggable å±æ€§**
3. âœ… **è§£å†³ contentEditable å†²çª**
4. âœ… **æ·»åŠ æ‹–æ‹½æ‰‹æŸ„**
5. âœ… **ä½¿ç”¨äº‹ä»¶æ•è·é˜¶æ®µ**
6. âœ… **æ­£ç¡®çš„ preventDefault ä½¿ç”¨**
7. âœ… **å®Œæ•´çš„çŠ¶æ€ç®¡ç†**
8. âœ… **æ¸…æ™°çš„è§†è§‰åé¦ˆ**

ç°åœ¨æ‹–æ‹½åŠŸèƒ½åº”è¯¥å®Œç¾å·¥ä½œï¼ğŸš€
